{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { useEffect } from \"react\";\nimport { axiosPrivate } from \"../api/axios\";\nimport useRefreshToken from \"./useRefreshToken\";\nimport useAuth from \"./useAuth\";\n\nvar useAxiosPrivate = function useAxiosPrivate() {\n  var refresh = useRefreshToken();\n\n  var _useAuth = useAuth(),\n      auth = _useAuth.auth;\n\n  useEffect(function () {\n    var requestIntercept = axiosPrivate.interceptors.request.use(function (config) {\n      if (!config.headers[\"Authorization\"]) {\n        config.headers[\"Authorization\"] = \"Bearer \" + (auth == null ? void 0 : auth.accessToken);\n      }\n\n      return config;\n    }, function (error) {\n      return Promise.reject(error);\n    });\n    var responseIntercept = axiosPrivate.interceptors.response.use(function (response) {\n      return response;\n    }, function _callee(error) {\n      var _error$response;\n\n      var prevRequest, newAccessToken;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              prevRequest = error == null ? void 0 : error.config;\n\n              if (!((error == null ? void 0 : (_error$response = error.response) == null ? void 0 : _error$response.status) === 403 && !(prevRequest != null && prevRequest.sent))) {\n                _context.next = 8;\n                break;\n              }\n\n              prevRequest.sent = true;\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(refresh());\n\n            case 5:\n              newAccessToken = _context.sent;\n              prevRequest.headers[\"Authorization\"] = \"Bearer \" + newAccessToken;\n              return _context.abrupt(\"return\", axiosPrivate(prevRequest));\n\n            case 8:\n              return _context.abrupt(\"return\", Promise.reject(error));\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n    return function () {\n      axiosPrivate.interceptors.request.eject(requestIntercept);\n      axiosPrivate.interceptors.response.eject(responseIntercept);\n    };\n  }, [auth, refresh]);\n  return axiosPrivate;\n};\n\nexport default useAxiosPrivate;","map":{"version":3,"names":["useEffect","axiosPrivate","useRefreshToken","useAuth","useAxiosPrivate","refresh","auth","requestIntercept","interceptors","request","use","config","headers","accessToken","error","Promise","reject","responseIntercept","response","prevRequest","status","sent","newAccessToken","eject"],"sources":["D:/Youcode/Projet/Full Stcuk JavaScript/ZELIVERY/src/hooks/useAxiosPrivate.js"],"sourcesContent":["import { useEffect } from \"react\";\r\n\r\nimport { axiosPrivate } from \"../api/axios\";\r\n\r\nimport useRefreshToken from \"./useRefreshToken\";\r\nimport useAuth from \"./useAuth\";\r\n\r\nconst useAxiosPrivate = () => {\r\n  const refresh = useRefreshToken();\r\n  const { auth } = useAuth();\r\n\r\n  useEffect(() => {\r\n    const requestIntercept = axiosPrivate.interceptors.request.use(\r\n      (config) => {\r\n        if (!config.headers[\"Authorization\"]) {\r\n          config.headers[\"Authorization\"] = `Bearer ${auth?.accessToken}`;\r\n        }\r\n        return config;\r\n      },\r\n      (error) => Promise.reject(error)\r\n    );\r\n\r\n    const responseIntercept = axiosPrivate.interceptors.response.use(\r\n      (response) => response,\r\n      async (error) => {\r\n        const prevRequest = error?.config;\r\n        if (error?.response?.status === 403 && !prevRequest?.sent) {\r\n          prevRequest.sent = true;\r\n          const newAccessToken = await refresh();\r\n          prevRequest.headers[\"Authorization\"] = `Bearer ${newAccessToken}`;\r\n          return axiosPrivate(prevRequest);\r\n        }\r\n        return Promise.reject(error);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      axiosPrivate.interceptors.request.eject(requestIntercept);\r\n      axiosPrivate.interceptors.response.eject(responseIntercept);\r\n    };\r\n  }, [auth, refresh]);\r\n\r\n  return axiosPrivate;\r\n};\r\n\r\nexport default useAxiosPrivate;\r\n"],"mappings":";AAAA,SAASA,SAAT,QAA0B,OAA1B;AAEA,SAASC,YAAT;AAEA,OAAOC,eAAP;AACA,OAAOC,OAAP;;AAEA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;EAC5B,IAAMC,OAAO,GAAGH,eAAe,EAA/B;;EACA,eAAiBC,OAAO,EAAxB;EAAA,IAAQG,IAAR,YAAQA,IAAR;;EAEAN,SAAS,CAAC,YAAM;IACd,IAAMO,gBAAgB,GAAGN,YAAY,CAACO,YAAb,CAA0BC,OAA1B,CAAkCC,GAAlC,CACvB,UAACC,MAAD,EAAY;MACV,IAAI,CAACA,MAAM,CAACC,OAAP,CAAe,eAAf,CAAL,EAAsC;QACpCD,MAAM,CAACC,OAAP,CAAe,eAAf,iBAA4CN,IAA5C,oBAA4CA,IAAI,CAAEO,WAAlD;MACD;;MACD,OAAOF,MAAP;IACD,CANsB,EAOvB,UAACG,KAAD;MAAA,OAAWC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAX;IAAA,CAPuB,CAAzB;IAUA,IAAMG,iBAAiB,GAAGhB,YAAY,CAACO,YAAb,CAA0BU,QAA1B,CAAmCR,GAAnC,CACxB,UAACQ,QAAD;MAAA,OAAcA,QAAd;IAAA,CADwB,EAExB,iBAAOJ,KAAP;MAAA;;MAAA;MAAA;QAAA;UAAA;YAAA;cACQK,WADR,GACsBL,KADtB,oBACsBA,KAAK,CAAEH,MAD7B;;cAAA,MAEM,CAAAG,KAAK,QAAL,+BAAAA,KAAK,CAAEI,QAAP,qCAAiBE,MAAjB,MAA4B,GAA5B,IAAmC,EAACD,WAAD,YAACA,WAAW,CAAEE,IAAd,CAFzC;gBAAA;gBAAA;cAAA;;cAGIF,WAAW,CAACE,IAAZ,GAAmB,IAAnB;cAHJ;cAAA,iCAIiChB,OAAO,EAJxC;;YAAA;cAIUiB,cAJV;cAKIH,WAAW,CAACP,OAAZ,CAAoB,eAApB,gBAAiDU,cAAjD;cALJ,iCAMWrB,YAAY,CAACkB,WAAD,CANvB;;YAAA;cAAA,iCAQSJ,OAAO,CAACC,MAAR,CAAeF,KAAf,CART;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAFwB,CAA1B;IAcA,OAAO,YAAM;MACXb,YAAY,CAACO,YAAb,CAA0BC,OAA1B,CAAkCc,KAAlC,CAAwChB,gBAAxC;MACAN,YAAY,CAACO,YAAb,CAA0BU,QAA1B,CAAmCK,KAAnC,CAAyCN,iBAAzC;IACD,CAHD;EAID,CA7BQ,EA6BN,CAACX,IAAD,EAAOD,OAAP,CA7BM,CAAT;EA+BA,OAAOJ,YAAP;AACD,CApCD;;AAsCA,eAAeG,eAAf"},"metadata":{},"sourceType":"module"}